import"./modulepreload-polyfill-B5Qt9EMX.js";const A=()=>{const t={selectedItemsContainer:null,totalPriceDisplay:null,productSelect:null,addToCartButton:null,stockInfoDisplay:null};return{initialize:()=>{const d=document.getElementById("app"),a=document.createElement("div"),c=document.createElement("div"),m=document.createElement("h1");t.selectedItemsContainer=document.createElement("div"),t.totalPriceDisplay=document.createElement("div"),t.productSelect=document.createElement("select"),t.addToCartButton=document.createElement("button"),t.stockInfoDisplay=document.createElement("div"),t.selectedItemsContainer.id="cart-items",t.totalPriceDisplay.id="cart-total",t.productSelect.id="product-select",t.addToCartButton.id="add-to-cart",t.stockInfoDisplay.id="stock-status",a.className="bg-gray-100 p-8",c.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",m.className="text-2xl font-bold mb-4",t.totalPriceDisplay.className="text-xl font-bold my-4",t.productSelect.className="border rounded p-2 mr-2",t.addToCartButton.className="bg-blue-500 text-white px-4 py-2 rounded",t.stockInfoDisplay.className="text-sm text-gray-500 mt-2",m.textContent="장바구니",t.addToCartButton.textContent="추가",c.appendChild(m),c.appendChild(t.selectedItemsContainer),c.appendChild(t.totalPriceDisplay),c.appendChild(t.productSelect),c.appendChild(t.addToCartButton),c.appendChild(t.stockInfoDisplay),a.appendChild(c),d.appendChild(a)},updateProductOptions:d=>{t.productSelect.innerHTML="",d.forEach(a=>{const c=document.createElement("option");c.value=a.id,c.textContent=`${a.name} - ${a.price}원`,a.quantity===0&&(c.disabled=!0),t.productSelect.appendChild(c)})},updateTotalPrice:(d,a)=>{const c=document.getElementById("loyalty-points");if(t.totalPriceDisplay.textContent=`총액: ${Math.round(d)}원`,c&&t.totalPriceDisplay.appendChild(c),a>0){const m=document.createElement("span");m.className="text-green-500 ml-2",m.textContent=`(${(a*100).toFixed(1)}% 할인 적용)`,t.totalPriceDisplay.appendChild(m)}},renderBonusPoints:d=>{let a=document.getElementById("loyalty-points");a||(a=document.createElement("span"),a.id="loyalty-points",a.className="text-blue-500 ml-2",t.totalPriceDisplay.appendChild(a)),a.textContent=`(포인트: ${d})`},updateStockInfoDisplay:d=>{let a="";d.forEach(c=>{c.quantity<5&&(a+=`${c.name}: ${c.quantity>0?`재고 부족 (${c.quantity}개 남음)`:"품절"}
`)}),t.stockInfoDisplay.textContent=a},addItemToCart:(d,a=1)=>{const c=document.getElementById("cart-items"),m=document.getElementById(d.id);if(m){const D=parseInt(m.querySelector("span").textContent.split("x ")[1])+a;m.querySelector("span").textContent=`${d.name} - ${d.price}원 x ${D}`}else{const S=document.createElement("div");S.id=d.id,S.className="flex justify-between items-center mb-2",S.innerHTML=`
        <span>${d.name} - ${d.price}원 x ${a}</span>
        <div>
          <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
            data-product-id="${d.id}" data-change="-1">-</button>
          <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
            data-product-id="${d.id}" data-change="1">+</button>
          <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" 
            data-product-id="${d.id}">삭제</button>
        </div>
      `,c.appendChild(S)}},setupEventListeners:(d,a)=>{const c=document.getElementById("add-to-cart"),m=document.getElementById("cart-items");c.addEventListener("click",d),m.addEventListener("click",a)},getSelectedProductId:()=>document.getElementById("product-select").value,getCartItems:()=>document.getElementById("cart-items").children}},_=[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],I={BULK_DISCOUNT_THRESHOLD:30,BULK_DISCOUNT_RATE:.25,TUESDAY_DISCOUNT_RATE:.1,FLASH_SALE_DISCOUNT_RATE:.2,SUGGESTED_PRODUCT_DISCOUNT_RATE:.05,FLASH_SALE_CHANCE:.3,FLASH_SALE_INTERVAL:3e4,FLASH_SALE_INITIAL_DELAY:1e4,SUGGESTION_INTERVAL:6e4,SUGGESTION_INITIAL_DELAY:2e4,PRODUCT_DISCOUNTS:{p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},QUANTITY_DISCOUNT_THRESHOLD:10},x={products:[],lastSelectedItem:null,bonusPoints:0,totalAmount:0,itemCount:0};let f={...x};const T=[],C=()=>({...f}),y=t=>{f={...f,...t},g()},g=()=>{T.forEach(t=>{t(C())})},L=t=>(T.push(t),()=>{const n=T.indexOf(t);n!==-1&&T.splice(n,1)}),N=t=>{y({...x,products:JSON.parse(JSON.stringify(t))})},E=t=>{let n=0,o=0,e=0;const i=C(),s=t.getCartItems();for(let u=0;u<s.length;u++){const l=P(s[u],e,i.products);e=l.subTotal,o+=l.addedCount,n+=l.addedAmount}let r=0;if(o>=I.BULK_DISCOUNT_THRESHOLD){const u=n*I.BULK_DISCOUNT_RATE,l=e-n;u>l?(n=e*(1-I.BULK_DISCOUNT_RATE),r=I.BULK_DISCOUNT_RATE):r=(e-n)/e||0}else r=(e-n)/e||0;new Date().getDay()===2&&(n*=1-I.TUESDAY_DISCOUNT_RATE,r=Math.max(r,I.TUESDAY_DISCOUNT_RATE));const p=Math.floor(n/1e3);y({...i,totalAmount:n,itemCount:o,bonusPoints:p}),t.updateTotalPrice(n,r),t.renderBonusPoints(p),t.updateStockInfoDisplay(i.products)},P=(t,n,o)=>{let e=n;const i=o.find(a=>a.id===t.id);if(!i)return console.error("Product not found:",t.id),{subTotal:e,addedCount:0,addedAmount:0};const s=t.querySelector("span").textContent,r=parseInt(s.split("x ")[1]),u=i.price*r;e+=u;let l=0;r>=I.QUANTITY_DISCOUNT_THRESHOLD&&(l=I.PRODUCT_DISCOUNTS[i.id]||0);const d=u*(1-l);return{subTotal:e,addedCount:r,addedAmount:d}},h=t=>{const n=document.getElementById("cart-items").children;for(let o=0;o<n.length;o++){const e=n[o],i=e.id,s=t.find(l=>l.id===i);if(!s)continue;const p=e.querySelector("span").textContent.match(/x\s*(\d+)$/);if(!p)continue;const u=parseInt(p[1]);e.querySelector("span").textContent=`${s.name} - ${s.price}원 x ${u}`}},U=t=>{const n=C();y({...n,totalAmount:0,itemCount:0,bonusPoints:0}),t.updateTotalPrice(0,0),t.renderBonusPoints(0),t.updateStockInfoDisplay(n.products)},O=t=>{const n=C(),o=t.getSelectedProductId(),e=n.products.find(i=>i.id===o);if(e&&e.quantity>0){t.addItemToCart(e,1);const i=n.products.map(s=>s.id===o?{...s,quantity:s.quantity-1}:s);y({...n,products:i,lastSelectedItem:o}),E(t)}else e&&e.quantity<=0&&alert("재고가 부족합니다.")},q=(t,n)=>{const o=t.target;if(o.classList.contains("quantity-change")||o.classList.contains("remove-item")){const e=C(),i=o.dataset.productId,s=document.getElementById(i),r=e.products.findIndex(l=>l.id===i);if(r===-1)return;const p=e.products[r],u=[...e.products];if(o.classList.contains("quantity-change")){const l=parseInt(o.dataset.change),d=s.querySelector("span").textContent.split("x "),a=parseInt(d[1]),c=a+l,m=d[0].trim();if(c>0&&(l<0||p.quantity>=l))s.querySelector("span").textContent=m+" x "+c,u[r]={...p,quantity:p.quantity-l};else if(c<=0)s.remove(),u[r]={...p,quantity:p.quantity+a};else{alert("재고가 부족합니다.");return}}else if(o.classList.contains("remove-item")){const l=parseInt(s.querySelector("span").textContent.split("x ")[1]);s.remove(),u[r]={...p,quantity:p.quantity+l}}y({...e,products:u}),E(n)}},b=t=>{const n=()=>{const o=C(),e=Math.floor(Math.random()*o.products.length),i=o.products[e];if(Math.random()<I.FLASH_SALE_CHANCE&&i.quantity>0){const s=[...o.products];s[e]={...i,price:Math.round(i.price*(1-I.FLASH_SALE_DISCOUNT_RATE))},alert("번개세일! "+i.name+"이(가) 20% 할인 중입니다!"),y({products:s}),h(s),window.ui&&(E(window.ui),t(s))}};setTimeout(()=>{setInterval(n,I.FLASH_SALE_INTERVAL)},Math.random()*I.FLASH_SALE_INITIAL_DELAY)},B=(t,n)=>{setTimeout(()=>{setInterval(()=>{const o=C(),e=n();if(e){const i=o.products.filter(s=>s.id!==e&&s.quantity>0);if(i.length>0){const s=Math.floor(Math.random()*i.length),r=i[s],p=o.products.findIndex(l=>l.id===r.id),u=[...o.products];u[p]={...r,price:Math.round(r.price*(1-I.SUGGESTED_PRODUCT_DISCOUNT_RATE))},alert(r.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),y({products:u}),h(u),window.ui&&(E(window.ui),t(u))}}},I.SUGGESTION_INTERVAL)},Math.random()*I.SUGGESTION_INITIAL_DELAY)},v=()=>{N(_);const t=A();t.initialize(),t.updateProductOptions(C().products),window.ui=t,L(e=>{t.updateStockInfoDisplay(e.products)}),U(t);const n=()=>O(t),o=e=>q(e,t);t.setupEventListeners(n,o),b(t.updateProductOptions),B(t.updateProductOptions,()=>C().lastSelectedItem)};v();
